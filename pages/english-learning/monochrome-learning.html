<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monochrome Learning</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Sans+KR:wght@400;500;600&display=swap');

        :root {
            --bg: #ffffff;
            --surface: #fafafa;
            --border: #e0e0e0;
            --text-primary: #000000;
            --text-secondary: #4a4a4a;
            --text-muted: #888888;
            --accent: #333333;
            --hover: #f5f5f5;
        }

        .theme-dark {
            --bg: #000000;
            --surface: #1a1a1a;
            --border: #333333;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #999999;
            --accent: #e0e0e0;
            --hover: #2a2a2a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.4;
            min-height: 100vh;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        body.size-md { font-size: 18px; }
        body.size-lg { font-size: 20px; }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--text-primary);
        }

        .title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .stats {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .topics {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 4px 0;
        }

        .topic-btn {
            padding: 10px 20px;
            background: var(--bg);
            border: 1px solid var(--text-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .topic-btn:hover {
            background: var(--text-primary);
            color: var(--bg);
        }

        .topic-btn.active {
            background: var(--text-primary);
            color: var(--bg);
        }

        .content {
            flex: 1;
            border: 2px solid var(--text-primary);
            display: flex;
            flex-direction: column;
            min-height: 500px;
        }

        .content-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--surface);
        }

        .content-info {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .content-topic {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
        }

        .viewer {
            flex: 1;
            padding: 40px 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            perspective: 1000px;
            position: relative;
        }

        .card {
            width: 100%;
            max-width: 600px;
            min-height: 350px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.7s ease;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-side {
            position: absolute;
            width: 100%;
            min-height: 350px;
            backface-visibility: hidden;
            border: 2px solid var(--text-primary);
            background: var(--bg);
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .card-back {
            transform: rotateY(180deg);
            background: var(--surface);
        }

        .lang-badge {
            border: 1px solid var(--text-primary);
            padding: 6px 16px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .text-content {
            font-size: 1.3rem;
            line-height: 1.5;
            font-weight: 500;
            color: var(--text-primary);
            word-break: keep-all;
        }

        .korean-text {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .sentence {
            display: block;
            margin-bottom: 12px;
        }

        .sentence:last-child {
            margin-bottom: 0;
        }

        .sentence-1 { color: var(--text-primary); }
        .sentence-2 { color: var(--text-secondary); }
        .sentence-3 { color: var(--text-muted); }
        .sentence-4 { color: var(--accent); }

        .variants {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .variant-btn {
            width: 36px;
            height: 36px;
            border: 1px solid var(--text-primary);
            background: var(--bg);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .variant-btn:hover {
            background: var(--text-primary);
            color: var(--bg);
        }

        .variant-btn.active {
            background: var(--text-primary);
            color: var(--bg);
        }

        .navigation {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-btn {
            padding: 12px 24px;
            background: var(--bg);
            border: 2px solid var(--text-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .nav-btn:hover:not(:disabled) {
            background: var(--text-primary);
            color: var(--bg);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .progress {
            flex: 1;
            text-align: center;
        }

        .progress-text {
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 150px;
            height: 6px;
            border: 1px solid var(--text-primary);
            margin: 0 auto;
            background: var(--bg);
        }

        .progress-fill {
            height: 100%;
            background: var(--text-primary);
            transition: width 0.3s ease;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 100;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            background: var(--bg);
            border: 1px solid var(--text-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .control-btn:hover {
            background: var(--text-primary);
            color: var(--bg);
        }

        .control-btn.active {
            background: var(--text-primary);
            color: var(--bg);
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
                gap: 16px;
            }
            
            .header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
                text-align: center;
            }

            .viewer {
                padding: 30px 20px;
                min-height: 350px;
            }

            .card-side {
                min-height: 280px;
                padding: 24px;
            }

            .text-content {
                font-size: 1.2rem;
            }

            .navigation {
                flex-direction: column;
                gap: 16px;
            }

            .nav-btn {
                width: 100%;
            }

            .controls {
                position: static;
                justify-content: center;
                margin-bottom: 16px;
            }
        }

        @media (max-width: 480px) {
            body { font-size: 14px; }
            body.size-md { font-size: 16px; }
            body.size-lg { font-size: 18px; }

            .container {
                padding: 12px;
            }

            .viewer {
                min-height: 300px;
            }

            .card-side {
                min-height: 240px;
                padding: 20px;
            }

            .text-content {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body class="size-md">
    <div class="container">
        <div class="controls">
            <button class="control-btn" id="themeBtn" title="Toggle theme">◐</button>
            <button class="control-btn" id="sizeSmBtn" title="Small text">S</button>
            <button class="control-btn active" id="sizeMdBtn" title="Medium text">M</button>
            <button class="control-btn" id="sizeLgBtn" title="Large text">L</button>
        </div>

        <header class="header">
            <h1 class="title">MONOCHROME</h1>
            <div class="stats">
                <div>Topics: <span id="topicCount">0</span></div>
                <div>Items: <span id="itemCount">0</span></div>
                <div>Done: <span id="doneCount">0</span></div>
                <div>Progress: <span id="progressPercent">0%</span></div>
            </div>
        </header>

        <div class="topics" id="topics">
            <button class="topic-btn">Loading...</button>
        </div>

        <main class="content">
            <div class="content-header">
                <span class="content-info" id="itemInfo">ITEM 1 / 10</span>
                <span class="content-topic" id="currentTopic">SELECT TOPIC</span>
            </div>

            <div class="viewer" id="viewer">
                <div class="card" id="card">
                    <div class="card-side">
                        <div class="lang-badge">KOREAN</div>
                        <div class="text-content korean-text" id="koreanText">
                            주제를 선택하여 학습을 시작하세요
                        </div>
                    </div>
                    <div class="card-side card-back">
                        <div class="lang-badge">ENGLISH</div>
                        <div class="text-content" id="englishText">
                            Select a topic to start learning
                        </div>
                        <div class="variants" id="variants">
                            <button class="variant-btn active">1</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <nav class="navigation">
            <button class="nav-btn" id="prevBtn">← PREV</button>
            <div class="progress">
                <div class="progress-text" id="progressText">1 / 10</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <button class="nav-btn" id="nextBtn">NEXT →</button>
        </nav>
    </div>

    <script>
        class MonochromeLearning {
            constructor() {
                this.topics = [];
                this.currentTopic = null;
                this.currentIndex = 0;
                this.completed = new Set();
                this.flipped = false;
                this.variantIndex = 0;
                this.init();
            }

            async init() {
                await this.loadTopics();
                this.setupEvents();
                this.loadProgress();
            }

            async loadTopics() {
                console.log('🔄 MONOCHROME: Loading topics from known files...');
                
                // 실제 폴더에 있는 파일들 하드코딩
                const knownFiles = [
                    'katalk-001.json',
                    'katalk-002.json', 
                    'katalk-003.json',
                    'katalk-004.json',
                    'sw-dev.json',
                    'workplace.json'
                ];
                
                try {
                    const promises = knownFiles.map(async (file) => {
                        try {
                            const response = await fetch(`data/${file}`);
                            if (!response.ok) return null;
                            
                            const data = await response.json();
                            console.log(`✅ Loaded: ${file} (${data.items?.length || 0} items)`);
                            
                            return {
                                id: file.replace('.json', ''),
                                name: data.topic || file.replace('.json', '').replace(/[-_]/g, ' ').toUpperCase(),
                                filename: file,
                                items: data.items || []
                            };
                        } catch (error) {
                            console.log(`❌ Failed to load: ${file}`);
                            return null;
                        }
                    });
                    
                    const results = await Promise.all(promises);
                    this.topics = results.filter(t => t !== null && t.items.length > 0);
                    
                    console.log(`📚 MONOCHROME: Successfully loaded ${this.topics.length} topics`);
                    
                    this.renderTopics();
                    if (this.topics.length > 0) {
                        this.selectTopic(this.topics[0]);
                    }
                    
                } catch (error) {
                    console.error('❌ MONOCHROME: Failed to load topics:', error);
                }
            }

            renderTopics() {
                const container = document.getElementById('topics');
                container.innerHTML = '';
                
                if (this.topics.length === 0) {
                    const btn = document.createElement('button');
                    btn.className = 'topic-btn';
                    btn.textContent = 'NO FILES FOUND';
                    btn.disabled = true;
                    container.appendChild(btn);
                    return;
                }
                
                this.topics.forEach((topic, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'topic-btn';
                    btn.textContent = topic.name;
                    btn.title = `${topic.filename} - ${topic.items.length} items`;
                    btn.onclick = () => this.selectTopic(topic);
                    if (idx === 0) btn.classList.add('active');
                    container.appendChild(btn);
                });
                
                console.log(`🎯 MONOCHROME: Rendered ${this.topics.length} topic buttons`);
                this.updateStats();
            }

            selectTopic(topic) {
                this.currentTopic = topic;
                this.currentIndex = 0;
                this.flipped = false;
                this.variantIndex = 0;
                
                document.querySelectorAll('.topic-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.textContent === topic.name.toUpperCase());
                });
                
                document.getElementById('currentTopic').textContent = topic.name.toUpperCase();
                this.displayItem();
                this.updateStats();
            }

            displayItem() {
                if (!this.currentTopic?.items?.[this.currentIndex]) return;
                
                const item = this.currentTopic.items[this.currentIndex];
                const total = this.currentTopic.items.length;
                
                document.getElementById('itemInfo').textContent = `ITEM ${this.currentIndex + 1} / ${total}`;
                
                document.getElementById('koreanText').innerHTML = this.formatText(item.korean);
                
                this.displayVariant(0);
                this.setupVariants(item.english_variations || []);
                
                document.getElementById('card').classList.remove('flipped');
                this.flipped = false;
                
                this.updateNavigation();
                this.updateProgress();
                
                setTimeout(() => {
                    const key = `${this.currentTopic.id}-${item.id}`;
                    if (!this.completed.has(key)) {
                        this.completed.add(key);
                        this.saveProgress();
                        this.updateStats();
                    }
                }, 1500);
            }

            formatText(text) {
                return text.split('.').filter(s => s.trim()).map((sentence, index) => {
                    const trimmed = sentence.trim();
                    const final = trimmed + (trimmed.endsWith('.') ? '' : '.');
                    const colorClass = `sentence-${(index % 4) + 1}`;
                    return `<span class="sentence ${colorClass}">${final}</span>`;
                }).join('');
            }

            setupVariants(variations) {
                const container = document.getElementById('variants');
                container.innerHTML = '';
                
                variations.forEach((_, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'variant-btn';
                    btn.textContent = idx + 1;
                    if (idx === 0) btn.classList.add('active');
                    
                    btn.onclick = (e) => {
                        e.stopPropagation();
                        this.displayVariant(idx);
                    };
                    
                    container.appendChild(btn);
                });
            }

            displayVariant(idx) {
                const item = this.currentTopic?.items?.[this.currentIndex];
                if (!item) return;
                
                const variations = item.english_variations || [];
                this.variantIndex = idx;
                
                document.getElementById('englishText').innerHTML = 
                    this.formatText(variations[idx] || 'No variation available');
                
                document.querySelectorAll('.variant-btn').forEach((btn, i) => {
                    btn.classList.toggle('active', i === idx);
                });
            }

            setupEvents() {
                document.getElementById('viewer').onclick = () => {
                    const card = document.getElementById('card');
                    this.flipped = !this.flipped;
                    card.classList.toggle('flipped', this.flipped);
                };
                
                document.getElementById('prevBtn').onclick = () => {
                    if (this.currentIndex > 0) {
                        this.currentIndex--;
                        this.displayItem();
                    }
                };
                
                document.getElementById('nextBtn').onclick = () => {
                    const total = this.currentTopic?.items?.length || 0;
                    if (this.currentIndex < total - 1) {
                        this.currentIndex++;
                        this.displayItem();
                    }
                };
                
                document.getElementById('themeBtn').onclick = () => {
                    document.body.classList.toggle('theme-dark');
                };
                
                document.getElementById('sizeSmBtn').onclick = () => this.setSize('sm');
                document.getElementById('sizeMdBtn').onclick = () => this.setSize('md');
                document.getElementById('sizeLgBtn').onclick = () => this.setSize('lg');
                
                document.onkeydown = (e) => {
                    if (e.key === 'ArrowLeft') {
                        document.getElementById('prevBtn').click();
                    } else if (e.key === 'ArrowRight') {
                        document.getElementById('nextBtn').click();
                    } else if (e.key === ' ') {
                        e.preventDefault();
                        document.getElementById('viewer').click();
                    }
                };
            }

            setSize(size) {
                document.body.className = document.body.classList.contains('theme-dark') ? 
                    `theme-dark size-${size}` : `size-${size}`;
                
                document.querySelectorAll('.control-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(`size${size.charAt(0).toUpperCase() + size.slice(1)}Btn`).classList.add('active');
            }

            updateNavigation() {
                const total = this.currentTopic?.items?.length || 0;
                document.getElementById('prevBtn').disabled = this.currentIndex === 0;
                document.getElementById('nextBtn').disabled = this.currentIndex === total - 1;
            }

            updateProgress() {
                const total = this.currentTopic?.items?.length || 0;
                const current = this.currentIndex + 1;
                
                document.getElementById('progressText').textContent = `${current} / ${total}`;
                
                const done = this.currentTopic?.items?.filter(item =>
                    this.completed.has(`${this.currentTopic.id}-${item.id}`)
                ).length || 0;
                
                const percent = total > 0 ? (done / total) * 100 : 0;
                document.getElementById('progressFill').style.width = percent + '%';
            }

            updateStats() {
                const topicCount = this.topics.length;
                const itemCount = this.topics.reduce((sum, t) => sum + (t.items?.length || 0), 0);
                const doneCount = this.completed.size;
                const progressPercent = itemCount > 0 ? Math.round((doneCount / itemCount) * 100) : 0;
                
                document.getElementById('topicCount').textContent = topicCount;
                document.getElementById('itemCount').textContent = itemCount;
                document.getElementById('doneCount').textContent = doneCount;
                document.getElementById('progressPercent').textContent = progressPercent + '%';
            }

            saveProgress() {
                localStorage.setItem('monochromeProgress', JSON.stringify([...this.completed]));
            }

            loadProgress() {
                const saved = localStorage.getItem('monochromeProgress');
                if (saved) {
                    this.completed = new Set(JSON.parse(saved));
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new MonochromeLearning();
        });
    </script>
</body>
</html>